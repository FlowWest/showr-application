text=~paste0(date, "<br>",
pretty_num(round(red, 1)), " af"),
hoverinfo="text") %>%
add_trace(data = filter(spread_iso, year(date) == 2017),
x=~date, y=~`orange`,
fillcolor = '#ed8e12', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="67-70",
text=~paste0(date, "<br>",
pretty_num(round(orange, 1)), " af"),
hoverinfo="text") %>%
add_trace(data = filter(spread_iso, year(date) == 2017),
x=~date, y=~`baige`,
fillcolor = '#d9e0a3', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="61-66") %>%
add_trace(data = filter(spread_iso, year(date) == 2017),
x=~date, y=~`green`,
fillcolor = '#27824c', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="57-60") %>%
add_trace(data = filter(spread_iso, year(date) == 2017),
x=~date, y=~`cyan`,
fillcolor = '#56bfbd', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="53-56") %>%
add_trace(data = filter(blue_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#4C74C9', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="49-52") %>%
add_trace(data = filter(dark_blue_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#274a82', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="<48",
text = ~paste0(
"Storage Temperature Below 48 <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value,
type='scatter', mode='line', inherit = FALSE,
line=list(color="black", width=2),
name="Storage at Shasta Reservoir")
plot_ly(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#bcbcbc',
type='scatter', mode='none', showlegend=FALSE) %>%
add_trace(data = filter(red_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#d64646', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name=">71",
text=~paste0(date, "<br>",
pretty_num(round(red, 1)), " af"),
hoverinfo="text") %>%
add_trace(data = filter(orange_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#ed8e12', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="67-70",
text=~paste0(date, "<br>",
pretty_num(round(orange, 1)), " af"),
hoverinfo="text") %>%
add_trace(data = filter(baige_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#d9e0a3', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="61-66") %>%
add_trace(data = filter(green_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#27824c', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="57-60") %>%
add_trace(data = filter(cyan_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#56bfbd', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="53-56") %>%
add_trace(data = filter(blue_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#4C74C9', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="49-52") %>%
add_trace(data = filter(dark_blue_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#274a82', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="<48",
text = ~paste0(
"Storage Temperature Below 48 <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value,
type='scatter', mode='line', inherit = FALSE,
line=list(color="black", width=2),
name="Storage at Shasta Reservoir")
plot_ly(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#bcbcbc',
type='scatter', mode='none', showlegend=FALSE) %>%
add_trace(data = filter(red_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#d64646', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name=">71",
text = ~paste0(
"Storage Temperature Below 48 <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_trace(data = filter(orange_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#ed8e12', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="67-70",
text = ~paste0(
"Storage Temperature Below 48 <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_trace(data = filter(baige_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#d9e0a3', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="61-66") %>%
add_trace(data = filter(green_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#27824c', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="57-60") %>%
add_trace(data = filter(cyan_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#56bfbd', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="53-56") %>%
add_trace(data = filter(blue_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#4C74C9', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="49-52") %>%
add_trace(data = filter(dark_blue_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#274a82', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="<48",
text = ~paste0(
"Storage Temperature Below 48 <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value,
type='scatter', mode='line', inherit = FALSE,
line=list(color="black", width=2),
name="Storage at Shasta Reservoir")
plot_ly(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#bcbcbc',
type='scatter', mode='none', showlegend=FALSE) %>%
add_trace(data = filter(red_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#d64646', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name=">71",
text = ~paste0(
"Storage Temperature Above 70 <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_trace(data = filter(orange_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#ed8e12', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="67-70",
text = ~paste0(
"Storage Temperature Between 67 & 70 °F <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_trace(data = filter(baige_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#d9e0a3', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="61-66",
text = ~paste0(
"Storage Temperature Between 61 & 66 °F <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_trace(data = filter(green_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#27824c', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="57-60",
text = ~paste0(
"Storage Temperature Between 57 & 60 °F <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_trace(data = filter(cyan_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#56bfbd', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="53-56",
text = ~paste0(
"Storage Temperature Between 53 & 56 °F <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_trace(data = filter(blue_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#4C74C9', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="49-52",
text = ~paste0(
"Storage Temperature Between 49 & 52 °F <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_trace(data = filter(dark_blue_iso, year(date) == 2017),
x=~date, y=~accum_volume,
fillcolor = '#274a82', inherit = FALSE,
type='scatter', mode = 'none', fill='tozeroy',
legendgroup="Isothermals",
name="<48",
text = ~paste0(
"Storage Temperature Below 48 <br>",
date, "<br>",
"Volume ", round(total_storage_in_bin, 0), " taf"
),
hoverinfo = "text") %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value,
type='scatter', mode='line', inherit = FALSE,
line=list(color="black", width=2),
name="Storage at Shasta Reservoir")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
actionButton(ns("help_me_with_temps"), icon = "question-circle")
runApp()
icon("question-circle")
runApp()
runApp()
actionButton()
actionButton("this")
actionButton("this", label=NULL)
actionButton("this", label=NULL, class="this")
actionButton("this", label=NULL, class="btn-sx")
actionButton("this", label=NULL, class="btn-xs")
runApp()
runApp()
actionButton("fdas")
actionButton("fdas", "fdas")
runApp()
runApp()
runApp()
runApp()
isothermal_data
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
selectInput("fake-so-fake", label = NULL, choices=2010:2017, selected = 2017)
runApp()
runApp()
runApp()
selectInput("fake-so-fake", label = NULL, choices=2010:2017, selected = 2017, width = "100px")
runApp()
runApp()
runApp()
isothermal_data %>% tail()
isothermal_data %>% tail(10)
isothermal_data %>% tail(15)
isothermal_data %>% tail(14)
shiny::runApp()
runApp()
shiny::runApp()
library(lubridate)
library(dplyr)
library(readr)
# Water Year Type
historic_water_year_types <- readr::read_rds("data/operations/historical-water-year-index.rds")
current_water_year_types <- readr::read_rds("data/operations/2018-04-17-water-year-index.rds")
wy_class_lookups <- c(
"C" = "critical",
"D" = "dry",
"BN" = "below normal",
"AN" = "above normal",
"W" = "wet"
)
# if a historic year is chosen use the
# hey this person is in the year 2014
historic_water_year_types %>%
filter(year == 2014) %>%
mutate(classification = class_lookups[yr_type])
# if they choose the current year we have to use the current year dataframe
current_water_year_types %>%
filter(probability == 99) %>%
arrange(desc(date)) %>%
head(1)
get_year_classification <- function(y) {
if (y != year(today())) {
historic_water_year_types %>%
filter(year == y) %>%
mutate(classification = wy_class_lookups[yr_type]) %>%
pull(classification) %>%
as.character()
} else {
current_water_year_types %>%
filter(probability == 99) %>%
arrange(desc(date)) %>%
head(1) %>%
pull(classification) %>%
as.character()
}
}
get_year_classification("2017")
# summary of days over compliance
temp_compliance_points_daily_mean %>%
filter(year(datetime) == 2017) %>%
mutate(compliance_violation = case_when(
(month(datetime) %in% 5:10 & parameter_value > 56) ~ TRUE,
TRUE ~ FALSE
)) %>%
group_by(location_id) %>%
summarise(
days_out = sum(compliance_violation)
)
runApp()
# summary of end of season storage temperature
isothermal_data %>%
filter(year(date) == 2017, month(date) == 9) %>%
arrange(desc(date)) %>%
filter(temp <= 50)
# summary of end of season storage temperature
isothermal_data %>%
filter(year(date) == 2017, month(date) == 9) %>%
arrange(desc(date)) %>%
filter(temp <= 50) %>%
isothermal_data_total_volume_per_day <- isothermal_data %>%
group_by(date) %>%
summarise(
total_volume_taf = sum(volume_taf)
)
install.packages("magrittr")
install.packages("magrittr")
# summary of end of season storage temperature
isothermal_data %>%
filter(year(date) == 2017, month(date) == 9) %>%
arrange(desc(date)) %>%
filter(temp <= 50) %>%
group_by(date) %>%
summarise(
total = sum(volume_taf)
)
library(magrittr)
# summary of end of season storage temperature
isothermal_data %>%
filter(year(date) == 2017, month(date) == 9) %>%
arrange(desc(date)) %>%
filter(temp <= 50) %>%
group_by(date) %>%
summarise(
total = sum(volume_taf)
)
library(lubridate)
library(dplyr)
library(readr)
# summary of end of season storage temperature
isothermal_data %>%
filter(year(date) == 2017, month(date) == 9) %>%
arrange(desc(date)) %>%
filter(temp <= 50) %>%
group_by(date) %>%
summarise(
total = sum(volume_taf)
)
# summary of end of season storage temperature
isothermal_data %>%
filter(year(date) == 2017, month(date) == 9) %>%
arrange(desc(date)) %>%
filter(temp <= 50) %>%
group_by(date) %>%
summarise(
total = sum(volume_taf)
) %>% glimpse()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
install.packages("profviz")
install.packages("profvis")
install.packages("config")
runApp()
runApp()
shiny::runApp()
parameter_code_to_name <- c(
"15" = "storage",
"94" = "conservation_curve"
)
shasta_storage_data %>%
mutate(parameter_name = parameter_code_to_name[as.character(parameter_id)]) %>%
select(-parameter_id) %>%
spread(parameter_name, parameter_value) %>%
filter(year(datetime) == 2017) %>%
mutate(in_flood_control = storage > conservation_curve) %>%
group_by(location_id) %>%
summarise(
days_in_flood_control = sum(in_flood_control, na.rm = TRUE)
)
# summary for the number of redds in the system
redd_data %>%
filter(year(date) == 2017) %>%
pull(counts) %>% sum()
shiny::runApp()
# Tue Apr 24 14:35:03 2018 ------------------------------
Sys.time()
date()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
library(shiny)
temp_compliance_points_daily_mean <-
read_csv("https://s3-us-west-2.amazonaws.com/showr-data-site/showr_tempatures.csv",
col_types = cols(
datetime = col_date(format = ""),
location_id = col_character(),
parameter_id = col_integer(),
parameter_value = col_double()
))
library(shiny)
library(plotly)
library(dplyr)
library(lubridate)
library(DT)
library(leaflet)
library(rgdal)
library(zoo)
library(stringr)
library(readr)
library(tidyr)
library(forcats)
library(readr)
library(sparkline)
library(shinyjs)
library(measurements)
temp_compliance_points_daily_mean <-
read_csv("https://s3-us-west-2.amazonaws.com/showr-data-site/showr_tempatures.csv",
col_types = cols(
datetime = col_date(format = ""),
location_id = col_character(),
parameter_id = col_integer(),
parameter_value = col_double()
))
navbarPage("Showr",
tabPanel("Dashboard"),
tabPanel("Temperature"))
runApp('~/sho-wr/showr-test-app')
shiny::runApp('~/sho-wr/showr-test-app')
