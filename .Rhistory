add_trace(data=filter(isothermal_data_total_volume_per_day, year(date) == 2017),
x=~date, y=~total_volume_taf, fill='tozeroy', type='scatter', mode='lines',
fillcolor="rgb(74, 86, 96, 1)", line=list(color="#4a5660")) %>%
add_lines(data=below_50,
x=~date, y=~total_below_50,
line=list(size=8),
inherit = FALSE) %>%
add_lines(data=between_51_74,
x=~date, y=~total_below_50,
line=list(size=8),
inherit = FALSE) %>%
add_lines(data=filter(shasta_storage_data, parameter_id == 15,
year(datetime) == 2017) %>%
mutate(storage_taf = parameter_value/1000),
x=~datetime,
y=~storage_taf,
name="Shasta Storage", inherit = FALSE)
# NEW STORAGE PLOT
shasta_storage_data %>%
filter(parameter_id == 15)
# NEW STORAGE PLOT
sha_store <- shasta_storage_data %>%
filter(parameter_id == 15, year(datetime) == 2017)
shasta_store
sha_stire
sha_store
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillopacity = 1)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60')
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60'))
isothermal_data
iso_46_48 <- isothermal_data %>%
filter(volume_taf <= 48)
iso_46_48 <- isothermal_data %>%
filter(temp <= 48)
iso_49_52 <- isothermal_data %>%
filter(temp > 48, temp <= 52)
iso_46_48 <- isothermal_data %>%
filter(temp <= 48)
iso_49_52 <- isothermal_data %>%
filter(temp > 48, temp <= 52)
iso_53_56 <- isothermal_data %>%
filter(temp > 52, temp <= 55)
# NEW STORAGE PLOT
sha_store <- shasta_storage_data %>%
filter(parameter_id == 15, year(datetime) == 2017)
# dark blue
iso_46_48 <- isothermal_data %>%
filter(temp <= 48)
# blue
iso_49_52 <- isothermal_data %>%
filter(temp > 48, temp <= 52)
# cyan
iso_53_56 <- isothermal_data %>%
filter(temp > 52, temp <= 55)
# green
iso_57_60 <- isothermal_data %>%
filter(temp > 56, temp <= 60)
# baige
iso_61_66 <- isothermal_data %>%
filter(temp > 60, temp <= 66)
# orange
iso_67_70 <- isothermal_data %>%
filter(temp > 66, temp <= 70)
# red
iso_71_inf <- isothermal_data %>%
filter(temp > 70)
# NEW STORAGE PLOT
sha_store <- shasta_storage_data %>%
filter(parameter_id == 15, year(datetime) == 2017)
# dark blue
iso_46_48 <- isothermal_data %>%
filter(temp <= 48) %>%
filter(year(date) == 2017)
# blue
iso_49_52 <- isothermal_data %>%
filter(temp > 48, temp <= 52) %>%
filter(year(date) == 2017)
# cyan
iso_53_56 <- isothermal_data %>%
filter(temp > 52, temp <= 55) %>%
filter(year(date) == 2017)
# green
iso_57_60 <- isothermal_data %>%
filter(temp > 56, temp <= 60) %>%
filter(year(date) == 2017)
# baige
iso_61_66 <- isothermal_data %>%
filter(temp > 60, temp <= 66) %>%
filter(year(date) == 2017)
# orange
iso_67_70 <- isothermal_data %>%
filter(temp > 66, temp <= 70) %>%
filter(year(date) == 2017)
# red
iso_71_inf <- isothermal_data %>%
filter(temp > 70) %>%
filter(year(date) == 2017)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=iso_46_48, x=~date, y=~volume_taf)
# NEW STORAGE PLOT
sha_store <- shasta_storage_data %>%
filter(parameter_id == 15, year(datetime) == 2017)
# dark blue
iso_46_48 <- isothermal_data %>%
filter(temp <= 48) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# blue
iso_49_52 <- isothermal_data %>%
filter(temp > 48, temp <= 52) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# cyan
iso_53_56 <- isothermal_data %>%
filter(temp > 52, temp <= 55) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# green
iso_57_60 <- isothermal_data %>%
filter(temp > 56, temp <= 60) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# baige
iso_61_66 <- isothermal_data %>%
filter(temp > 60, temp <= 66) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# orange
iso_67_70 <- isothermal_data %>%
filter(temp > 66, temp <= 70) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# red
iso_71_inf <- isothermal_data %>%
filter(temp > 70) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=iso_46_48, x=~date, y=~volume_taf)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=iso_46_48, x=~date, y=~taf_volume)
iso_46_48
# NEW STORAGE PLOT
sha_store <- shasta_storage_data %>%
filter(parameter_id == 15, year(datetime) == 2017)
# dark blue
iso_46_48 <- isothermal_data %>%
filter(temp <= 48) %>%
group_by(date) %>%
summarise(volume_taf = sum(volume_taf)) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# blue
iso_49_52 <- isothermal_data %>%
filter(temp > 48, temp <= 52) %>%
group_by(date) %>%
summarise(volume_taf = sum(volume_taf)) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# cyan
iso_53_56 <- isothermal_data %>%
filter(temp > 52, temp <= 55) %>%
group_by(date) %>%
summarise(volume_taf = sum(volume_taf)) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# green
iso_57_60 <- isothermal_data %>%
filter(temp > 56, temp <= 60) %>%
group_by(date) %>%
summarise(volume_taf = sum(volume_taf)) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# baige
iso_61_66 <- isothermal_data %>%
filter(temp > 60, temp <= 66) %>%
group_by(date) %>%
summarise(volume_taf = sum(volume_taf)) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# orange
iso_67_70 <- isothermal_data %>%
filter(temp > 66, temp <= 70) %>%
group_by(date) %>%
summarise(volume_taf = sum(volume_taf)) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
# red
iso_71_inf <- isothermal_data %>%
filter(temp > 70) %>%
group_by(date) %>%
summarise(volume_taf = sum(volume_taf)) %>%
filter(year(date) == 2017) %>%
mutate(taf_volume = volume_taf * 1000)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=iso_46_48, x=~date, y=~taf_volume)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=iso_46_48, x=~date, y=~taf_volume) %>%
add_lines(data=iso_49_52, x=~date, y=~taf_volume)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=iso_46_48, x=~date, y=~taf_volume) %>%
add_lines(data=iso_49_52, x=~date, y=~taf_volume) %>%
add_lines(data=iso_53_56, x=~date, y=~taf_volume)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=iso_46_48, x=~date, y=~taf_volume) %>%
add_lines(data=iso_49_52, x=~date, y=~taf_volume) %>%
add_lines(data=iso_53_56, x=~date, y=~taf_volume) %>%
add_lines(data=iso_57_60, x=~date, y=~taf_volume)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=iso_46_48, x=~date, y=~taf_volume) %>%
add_lines(data=iso_49_52, x=~date, y=~taf_volume) %>%
add_lines(data=iso_53_56, x=~date, y=~taf_volume) %>%
add_lines(data=iso_57_60, x=~date, y=~taf_volume) %>%
add_lines(data=iso_61_66, x=~date, y=~taf_volume) %>%
add_lines(data=iso_67_70, x=~date, y=~taf_volume) %>%
add_lines(data=iso_71_inf, x=~date, y=~taf_volume)
isothermal_data %>%
mutate(temp_code = case_when(
(temp <= 48) ~ "dark_blue",
(temp > 48 & temp <= 52) ~ "blue",
(temp > 52 & temp <= 56) ~ "cyan",
TRUE ~ as.character(NA)
))
isothermal_data %>%
mutate(temp_code = case_when(
(temp <= 48) ~ "dark_blue",
(temp > 48 & temp <= 52) ~ "blue",
(temp > 52 & temp <= 56) ~ "cyan",
(temp > 56 & temp <= 60) ~ "green",
(temp > 60 & temp <= 66) ~ "baige",
(temp > 66 & temp <= 70) ~ "orange",
(temp > 70) ~ "red",
TRUE ~ as.character(NA)
))
iso_color_coded <- isothermal_data %>%
mutate(temp_code = case_when(
(temp <= 48) ~ "dark_blue",
(temp > 48 & temp <= 52) ~ "blue",
(temp > 52 & temp <= 56) ~ "cyan",
(temp > 56 & temp <= 60) ~ "green",
(temp > 60 & temp <= 66) ~ "baige",
(temp > 66 & temp <= 70) ~ "orange",
(temp > 70) ~ "red",
TRUE ~ as.character(NA)
))
iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf))
iso_color_coded <- isothermal_data %>%
mutate(temp_code = case_when(
(temp <= 48) ~ "dark blue",
(temp > 48 & temp <= 52) ~ "blue",
(temp > 52 & temp <= 56) ~ "cyan",
(temp > 56 & temp <= 60) ~ "green",
(temp > 60 & temp <= 66) ~ "baige",
(temp > 66 & temp <= 70) ~ "orange",
(temp > 70) ~ "red",
TRUE ~ as.character(NA)
),
temp_code = factor(temp_code, levels = c("dark blue",
"blue",
"cyan",
"green",
"baige",
"orange",
"red")))
iso_color_coded
color_code_to_range_lookup <- c(
"dark_blue" = "<= 48",
)
color_code_to_range_lookup <- c(
"dark_blue" = "<= 48"
)
iso_color_coded_bins <- iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = volume_taf * 1000)
iso_color_coded_bins <- iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000)
iso_color_coded_bins
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=iso_color_coded_bins,
x=~date,
y=~volume_af, color=~temp_code)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=filter(iso_color_coded_bins, year(date) == 2017),
x=~date,
y=~volume_af, color=~temp_code)
iso_color_coded_bins <- iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code)
iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code)
iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code) %>%
group_by(date, temp_code)
iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code) %>%
group_by(date, temp_code) %>%
mutate(bin_below_temp = lag(volume_af))
iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code) %>%
group_by(date) %>%
mutate(bin_below_temp = lag(volume_af))
iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code) %>%
group_by(date) %>%
mutate(accum_volume = cumsum(volume_af))
x <- iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code) %>%
group_by(date) %>%
mutate(accum_volume = cumsum(volume_af))
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=filter(x, year(date) == 2017),
x=~date,
y=~accum_volume, color=~temp_code)
x <- iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code) %>%
group_by(date) %>%
mutate(accum_volume = cumsum(volume_af))
x %>% filter(year(date) == 2017)
x <- iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code) %>%
group_by(date) %>%
mutate(accum_volume = cumsum(volume_af),
accum_volume = case_when(
volume_af == 0 ~ as.numeric(NA),
TRUE ~ accum_volume
))
x
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=filter(x, year(date) == 2017),
x=~date,
y=~accum_volume, color=~temp_code)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=filter(x, year(date) == 2017),
x=~date,
y=~accum_volume, color=~temp_code, inherit = FALSE)
xd <- iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code) %>%
group_by(date) %>%
mutate(accum_volume = cumsum(volume_af),
accum_volume = case_when(
volume_af == 0 ~ as.numeric(NA),
TRUE ~ accum_volume
))
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=filter(xd, year(date) == 2017),
x=~date,
y=~accum_volume, color=~temp_code, inherit = FALSE)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_lines(data=filter(xd, year(date) == 2017),
x=~date,
y=~accum_volume, color=~temp_code, inherit = FALSE)
plot_ly()
add_lines(data=filter(xd, year(date) == 2017),
x=~date,
y=~accum_volume, color=~temp_code, inherit = FALSE)
plot_ly() %>%
add_lines(data=filter(xd, year(date) == 2017),
x=~date,
y=~accum_volume, color=~temp_code, inherit = FALSE)
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60'))
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_trace(data = filter(xd, year(date) == 2017),
x=~date, y=~accum_volume, color=~temp_code,
type='scatter', mode='lines')
xd %>% filter(year(date) == 2017)
xd %>% filter(year(date) == 2017) %>% View()
xd %>% filter(year(date) == 2017) %>% ggplot(aes(date, accum_volume)) + geom_line()
xd %>% filter(year(date) == 2017) %>% ggplot(aes(date, accum_volume, color=temp_code)) + geom_line()
xd <- iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code) %>%
group_by(date) %>%
mutate(accum_volume = cumsum(volume_af)
# ,
# accum_volume = case_when(
#   volume_af == 0 ~ as.numeric(NA),
#   TRUE ~ accum_volume
# )
)
xd %>% filter(year(date) == 2017) %>% ggplot(aes(date, accum_volume, color=temp_code)) + geom_line()
xd %>% filter(year(date) == 2017) %>% ggplot(aes(date, accum_volume, color=temp_code)) + geom_area()
xd <- iso_color_coded %>%
group_by(date, temp_code) %>%
summarise(total_storage_in_bin = sum(volume_taf)) %>% ungroup() %>%
mutate(volume_af = total_storage_in_bin * 1000) %>%
arrange(date, temp_code) %>%
group_by(date) %>%
mutate(accum_volume = cumsum(volume_af)
,
accum_volume = case_when(
volume_af == 0 ~ as.numeric(NA),
TRUE ~ accum_volume
)
)
xd %>% filter(year(date) == 2017) %>% ggplot(aes(date, accum_volume, color=temp_code)) + geom_area()
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_trace(data = filter(xd, year(date) == 2017),
x=~date, y=~accum_volume, color=~temp_code,
type='scatter', mode='lines')
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_trace(data = filter(xd, year(date) == 2017, temp_code == "blue"),
x=~date, y=~accum_volume, color=~temp_code,
type='scatter', mode='lines')
plot_ly() %>%
add_lines(data=sha_store, x=~datetime, y=~parameter_value, fill='tozeroy',
fillcolor='#414d60',
line = list(color='#414d60')) %>%
add_trace(data = filter(xd, year(date) == 2017, temp_code == "blue"),
x=~date, y=~accum_volume, color=~temp_code,
type='scatter', mode='lines', inherit = FALSE)
